<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Nếu thì và những cách thay thế - VietHQ - Tìm đơn giản trong phức tạp</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="VietHQ" />
  <meta name="description" content="Bạn có biết rằng trên thế giới có một cộng đồng anti if, else. Trên đường đi tìm đường cách mệnh, coi như cũng tạo chút thử thách cho bản thân, mình đã tìm ra một số phương pháp tương đối hữu ích.
1. Thủ thuật refactor Các phương pháp này có thể coi như là trick để code trông gọn hơn, đồng thời loại bỏ if.
Dictionary Đây là phương pháp mình sử dụng từ lâu." />

  <meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.52" />


<link rel="canonical" href="https://gg4acrossover.github.io/hugosite/post/if-else-and-another/" />

<link rel="apple-touch-icon" sizes="180x180" href="/hugosite/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/hugosite/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/hugosite/favicon-16x16.png">
<link rel="manifest" href="/hugosite/manifest.json">
<link rel="mask-icon" href="/hugosite/safari-pinned-tab.svg" color="#5bbad5">







<link href="/hugosite/dist/even.min.css?v=3.1.1" rel="stylesheet">
<link href="/hugosite/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Nếu thì và những cách thay thế" />
<meta property="og:description" content="Bạn có biết rằng trên thế giới có một cộng đồng anti if, else. Trên đường đi tìm đường cách mệnh, coi như cũng tạo chút thử thách cho bản thân, mình đã tìm ra một số phương pháp tương đối hữu ích.
1. Thủ thuật refactor Các phương pháp này có thể coi như là trick để code trông gọn hơn, đồng thời loại bỏ if.
Dictionary Đây là phương pháp mình sử dụng từ lâu." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gg4acrossover.github.io/hugosite/post/if-else-and-another/" /><meta property="article:published_time" content="2018-12-19T13:58:26&#43;07:00"/>
<meta property="article:modified_time" content="2018-12-19T13:58:26&#43;07:00"/>

<meta itemprop="name" content="Nếu thì và những cách thay thế">
<meta itemprop="description" content="Bạn có biết rằng trên thế giới có một cộng đồng anti if, else. Trên đường đi tìm đường cách mệnh, coi như cũng tạo chút thử thách cho bản thân, mình đã tìm ra một số phương pháp tương đối hữu ích.
1. Thủ thuật refactor Các phương pháp này có thể coi như là trick để code trông gọn hơn, đồng thời loại bỏ if.
Dictionary Đây là phương pháp mình sử dụng từ lâu.">


<meta itemprop="datePublished" content="2018-12-19T13:58:26&#43;07:00" />
<meta itemprop="dateModified" content="2018-12-19T13:58:26&#43;07:00" />
<meta itemprop="wordCount" content="998">



<meta itemprop="keywords" content="swift," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Nếu thì và những cách thay thế"/>
<meta name="twitter:description" content="Bạn có biết rằng trên thế giới có một cộng đồng anti if, else. Trên đường đi tìm đường cách mệnh, coi như cũng tạo chút thử thách cho bản thân, mình đã tìm ra một số phương pháp tương đối hữu ích.
1. Thủ thuật refactor Các phương pháp này có thể coi như là trick để code trông gọn hơn, đồng thời loại bỏ if.
Dictionary Đây là phương pháp mình sử dụng từ lâu."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/hugosite/" class="logo">Vie</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/hugosite/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/hugosite/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/hugosite/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="http://gg4acrossover.github.io/">
        <li class="mobile-menu-item">Hire me</li>
      </a><a href="/hugosite/about/">
        <li class="mobile-menu-item">About me</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/hugosite/" class="logo">Vie</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/hugosite/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/hugosite/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/hugosite/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="http://gg4acrossover.github.io/">Hire me</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/hugosite/about/">About me</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Nếu thì và những cách thay thế</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-12-19 </span>
        
        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-thủ-thuật-refactor">1. Thủ thuật refactor</a>
<ul>
<li><a href="#dictionary">Dictionary</a></li>
<li><a href="#enum">Enum</a></li>
</ul></li>
<li><a href="#2-sử-dụng-functional-programming">2. Sử dụng functional programming</a>
<ul>
<li><a href="#filter">Filter</a></li>
<li><a href="#refinement-type">Refinement type</a></li>
</ul></li>
<li><a href="#3-mở-rộng">3. Mở rộng</a></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<p>Bạn có biết rằng trên thế giới có một cộng đồng anti if, else. Trên đường đi tìm đường cách mệnh, coi như cũng tạo chút thử thách cho bản thân, mình đã tìm ra một số phương pháp tương đối hữu ích.</p>

<h1 id="1-thủ-thuật-refactor">1. Thủ thuật refactor</h1>

<p>Các phương pháp này có thể coi như là trick để code trông gọn hơn, đồng thời loại bỏ <em>if</em>.</p>

<h2 id="dictionary">Dictionary</h2>

<p>Đây là phương pháp mình sử dụng từ lâu. Với phương pháp này thì ta có thể refactor hàm sau:</p>

<pre><code class="language-swift">func getEpisode(_ id: String) -&gt; Episode? {
    if id = &quot;E1&quot; {
    	return episode_1
    } else if id = &quot;E2&quot; {
    	return episode_2
    } else if {
    	...
    }

    ...
}
</code></pre>

<p>Thành dạng như sau</p>

<pre><code class="language-swift">let dict = [&quot;E1&quot;: episode_1,
            &quot;E2&quot;: episode_2,
            &quot;E3&quot;: episode_3]

func getEpisode(_ id: String) -&gt; Episode? {
    return dict[id]
}
</code></pre>

<h2 id="enum">Enum</h2>

<p>Nên sử dụng enum với những cái nào có chung format như ở trường hợp sau</p>

<p>Thay vì</p>

<pre><code class="language-swift">func play(type: Format) {
    switch type {
    	case .video: self.playVideo()
    	case .audio: self.playAudio()
    	...
    }
}
</code></pre>

<p>Tên các method ở trên đều có chung format play<strong>%TYPE%</strong>. Ta có thể gọi nó thông qua <em>selector</em> để loại bỏ hẳn <em>if</em></p>

<pre><code class="language-swift">enum Format: String {
    case video
    case audio
    case image
}

class Player: NSObject {
    func play(type: Format) {
        let selector = Selector.init(&quot;play\(type.rawValue.capitalized)&quot;)
        self.perform(selector)
    }

    ...
}

// Result
Player().play(type: .video)
</code></pre>

<p>Để sử dụng <strong>selector</strong>, các phương thức cần gắn thêm tiền tố <strong>@objc</strong> và class cần kế thừa <strong>NSObject</strong>.</p>

<h1 id="2-sử-dụng-functional-programming">2. Sử dụng functional programming</h1>

<h2 id="filter">Filter</h2>

<p>Đây là phương thức trong bộ tam <em>filter, map, reduce</em> ra đời kèm ngay ở phiên bản đầu của swift. Param truyền vào <strong>filter</strong> có dạng tổng quát như sau:</p>

<blockquote>
<p>(T) -&gt; Bool // hàm truyền vào 1 giá trị và return bool</p>
</blockquote>

<p>Như vậy ta có thể truyền vào tên hàm thay vì định nghĩa ra nó.</p>

<p>Giả sử bài toán ta đang giải quyết là tìm số nguyên dương trong mảng, thay vì viết:</p>

<pre><code class="language-swift">arr.filter { (value) -&gt; Bool in
    return value &gt; 0
}
</code></pre>

<p>Ta có thể truyền tên hàm vào trong <strong>filter</strong> để code ngắn gọn, rõ nghĩa hơn.</p>

<pre><code class="language-swift">// (Int) -&gt; Bool
func positive(x: Int) -&gt; Bool {
	return x &gt; 0
}

arr.filter(positive)

</code></pre>

<p>Nếu có nhiều hơn một điều kiện, ta có thể tổng hợp lại các hàm làm một. Giả sử ta muốn tìm số vừa lớn hơn 0 vừa nhỏ hơn 100, ta viết thêm điều kiện:</p>

<pre><code class="language-swift">func lessThan100(x: Int) -&gt; Bool {
    return x &lt; 100
}
</code></pre>

<p>Tiếp theo, ta sử dụng phương pháp <strong>composite</strong> để có 1 hàm dạng như: <strong>lessThan100AndPositive = lessThan100 &amp; positive</strong>. Lúc đó code sẽ gọn gàng ngăn nắp như này:</p>

<blockquote>
<p>arr.filter(lessThan100AndPositive)</p>
</blockquote>

<p>Nhưng trước hết, ta sẽ định nghĩa hai phương thức helper để tổng hợp điều kiện thuận tiện hơn và dễ dàng tái sử dụng lại code</p>

<pre><code class="language-swift">public class func allPass&lt;A&gt;(_ array: [(A) -&gt; Bool], value: A) -&gt; Bool {
    let predicate = array.map({ V.bind(value: value, to: $0) }) // [() -&gt; Bool]
    return checkAll(predicate)
}

public class func allPass&lt;A&gt;(_ array: [(A) -&gt; Bool]) -&gt; (A) -&gt; Bool {
    return { v in
        let predicate = array.map({ V.bind(value: v, to: $0) }) // [() -&gt; Bool]
        return checkAll(predicate)
    }
}
</code></pre>

<p>Mình tạo 2 phương thức đều có tên <strong>allPass</strong>, phương thức đầu trả về <em>Bool</em>, còn phương thức thứ hai có dạng <em>curry function</em> (hàm nhận vào 1 param và trả ra 1 hàm khác). Cả 2 hàm khác nhau về cách thức tạo nhưng cùng chung 1 mục đích sử dụng (tạm thời không bàn đến <em>bind</em> và <em>checkAll</em>)</p>

<p>Với 2 phương thức nêu trên ta có thể composite 2 điều kiện <strong>positive</strong> và <strong>lessThan100</strong> theo cách như sau</p>

<blockquote>
<p>allPass([positive,lessThan100]) // (Int) -&gt; Bool</p>
</blockquote>

<p>Và hàm filter sẽ được viết ngắn gọn như sau:</p>

<pre><code class="language-swift">func doFilterAll(_ value: Int) -&gt; Bool {
    // open comments below to use curry function
    // let and = V.allPass([positive,lessThan100]) // (Int) -&gt; Bool
    // return and(value)
    
    // using function return bool
    return V.allPass([positive,lessThan100], value: value)
}

arr.filter(doFilterAll)
</code></pre>

<p>Làm tương tự, ta có thể tạo hàm <strong>Or</strong> để tìm giá trị thỏa mãn 1 điều kiện trong tất cả các điều kiện được cung cấp.</p>

<p>Bạn thấy đó, với <em>functional</em> ta dễ dàng tách các đoạn kiểm tra điều kiện ra thành hàm riêng, dễ dàng tổng hợp chúng, đồng thời dễ test và tái sử dụng.</p>

<p>Để hiểu rõ hơn về hàm <strong>bind</strong> và <strong>checkAll</strong>, mình có đưa nó vào trong code ví dụ ở cuối bài viết.</p>

<h2 id="refinement-type">Refinement type</h2>

<p>Thế nào là <a href="https://en.wikipedia.org/wiki/Refinement_type">refinement type</a></p>

<blockquote>
<p>refinement type = value + predicates</p>
</blockquote>

<p>Như định nghĩa trên, <em>refinement type</em> sẽ có 2 thành phần:</p>

<pre><code>+ Giá trị
+ Điều kiện
</code></pre>

<p>Hai thành phần này có mối liên hệ chặt chẽ, còn liên kết thế nào thì có thể xem đoạn code ngay sau đây.</p>

<pre><code class="language-swift">Positive&lt;Double&gt;.of(100.0)?.value // 100
Positive&lt;Int&gt;.of(-1)?.value // nil
Both&lt;Positive&lt;Float&gt;,LessThan100&lt;Float&gt;&gt;.of(99)?.value // 99
Both&lt;Positive&lt;Float&gt;,LessThan100&lt;Float&gt;&gt;.of(101)?.value // nil
</code></pre>

<p>Như bạn thấy đã thấy, 100 thỏa mãn điều kiện lớn hơn 0; 99 thỏa mãn điều kiện nhỏ hơn 100 nên ta có thể sử dụng. Trong trường hợp không thỏa mãn (-1,101), giá trị nil được trả về.</p>

<p>Thậm chí ta chưa dùng tí <strong>if</strong> nào :D</p>

<p>Đoạn code định nghĩa <em>refinement type</em> như sau</p>

<pre><code class="language-swift">public protocol Refinement {
    associatedtype RefinedType
    static func pass(_ value: RefinedType) -&gt; Bool
}

public struct Refined&lt;A,R: Refinement&gt; where A == R.RefinedType {
    public let value: A
    public init?(_ value: A) {
        guard R.pass(value) else { return nil }
        self.value = value
    }
}

public extension Refinement {
    static func of(_ value: RefinedType) -&gt; Refined&lt;RefinedType,Self&gt;? {
        return Refined(value)
    }
}
</code></pre>

<p>Sử dụng sơ đồ khối để dễ hình dung</p>

<p><img src="/hugosite/images/note/if-else/Refinement-type.png" alt="img" /></p>

<p>Code ví dụ <a href="https://github.com/gg4acrossover/NoIf">source</a></p>

<h1 id="3-mở-rộng">3. Mở rộng</h1>

<p>Ngoài những cách trên thì còn rất nhiều cách để giảm thiểu if else:</p>

<ul>
<li>Sử dụng đa hình</li>
<li>Tách hàm</li>
<li>switch case :v</li>
<li>Sử dụng hàm cond (như trong <a href="https://vi.wikipedia.org/wiki/Lisp">Lisp</a>)</li>
<li>Blah blah</li>
</ul>

<hr />

<p>Tham khảo</p>

<ul>
<li><p>Thư viện ramdajs <a href="https://ramdajs.com/">https://ramdajs.com/</a></p></li>

<li><p>Ví dụ của <a href="https://github.com/peter-tomaselli/swift-refined">Peter tomaselli</a></p></li>
</ul>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">VietHQ</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2018-12-19</span>
  </p>
  
  
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/hugosite/tags/swift/">swift</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/hugosite/post/lam-viec-voi-response/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Làm việc với response</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/hugosite/post/make-swift-great-again/">
            <span class="next-text nav-default">Make swift great again</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'gg4acrossover';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:hoangquocviet1402@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/viet142" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/viethoangquoc1402/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/gg4acrossover" class="iconfont icon-github" title="github"></a>
  <a href="https://gg4acrossover.github.io/hugosite/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2017 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">VietHQ</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/hugosite/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/hugosite/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/hugosite/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/hugosite/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/hugosite/dist/even.min.js?v=3.1.1"></script>










<script>
  var _gaq=[['_setAccount','UA-99127158-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
</body>
</html>
