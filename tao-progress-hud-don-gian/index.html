<!DOCTYPE html>
<html lang="vi-EN">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/agate.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99127158-1', 'auto');
    ga('send', 'pageview');

    </script>

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="T·∫°o APIClient v·ªõi swift 3"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@viet142"/>



  	<meta property="og:title" content="T·∫°o APIClient v·ªõi swift 3 &middot; GG4aCrossover" />
  	<meta property="og:site_name" content="GG4aCrossover" />
  	<meta property="og:url" content="https://gg4acrossover.github.io/hugosite/tao-progress-hud-don-gian/" />

    
        
            <meta property="og:image" content="/hugosite/images/cover.jpg"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2017-05-29T15:11:07&#43;07:00" />

    
    <meta property="article:tag" content="swift" />
    
    

    <title>T·∫°o APIClient v·ªõi swift 3 &middot; GG4aCrossover</title>

    
    <meta name="description" content="1. Gi·ªõi thi·ªáu T·ª´ h·ªìi m·ªõi b·∫Øt ƒë·∫ßu l√†m IOS, th·∫±ng n√†o c≈©ng h·ªèi m√¨nh c√≥ bi·∫øt s·ª≠ d·ª•ng AFNetworking kh√¥ng? Kh·ªï n·ªói l√∫c ƒë√≥, m√¨nh m·ªõi chuy·ªÉn t·ª´ l√†m game sang, r·∫•t √≠t d" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/hugosite/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/hugosite/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/hugosite/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/hugosite/css/nav.css" />

    

    

    
      
          <link href="/hugosite/index.xml" rel="alternate" type="application/rss+xml" title="GG4aCrossover" />
      
      
    
    <meta name="generator" content="Hugo 0.20.7" />

    <link rel="canonical" href="https://gg4acrossover.github.io/hugosite/tao-progress-hud-don-gian/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": 
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "url": http://gg4acrossover.github.io/,
        "sameAs": [
            
            
             
             
             
             
             
            
        ],
        "description": Coder nh√¢n d√¢n
        
    },
    "headline": T·∫°o APIClient v·ªõi swift 3,
    "name": T·∫°o APIClient v·ªõi swift 3,
    "wordCount": 920,
    "timeRequired": "PT5M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": https://gg4acrossover.github.io/hugosite/tao-progress-hud-don-gian/,
    "datePublished": 2017-05-29T15:11Z,
    "dateModified": 2017-05-29T15:11Z,
    
    "keywords": swift,
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": https://gg4acrossover.github.io/hugosite/tao-progress-hud-don-gian/
    }
}
    </script>
    


    

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/viet142">Twitter</a>
            </li>
        
            <h4>Social</h4>
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/gg4acrossover">Github</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/hugosite/about/">About me</a>
            </li>
        
            <h4>My Site</h4>
            <li class="nav-opened" role="presentation">
            	<a href="/hugosite/">Home</a>
            </li>
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/hugosite/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">T·∫°o APIClient v·ªõi swift 3</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2017-05-29T15:11:07&#43;07:00">
            May 29, 2017
          </time>
        
         
          <span class="post-tag small"><a href="https://gg4acrossover.github.io/hugosite/tags/swift/">#swift</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<h3 id="1-gi·ªõi-thi·ªáu">1. Gi·ªõi thi·ªáu</h3>

<p>T·ª´ h·ªìi m·ªõi b·∫Øt ƒë·∫ßu l√†m IOS, th·∫±ng n√†o c≈©ng h·ªèi m√¨nh c√≥ bi·∫øt s·ª≠ d·ª•ng AFNetworking kh√¥ng? Kh·ªï n·ªói l√∫c ƒë√≥, m√¨nh m·ªõi chuy·ªÉn t·ª´ l√†m game sang, r·∫•t √≠t d√πng ƒë·∫øn lib, ƒëa s·ªë t·ª± vi·∫øt n√™n l∆° t∆° m∆° kh√¥ng bi·∫øt ch√∫ng n√≥ n√≥i ƒë·∫øn c√°i g√¨. D√πng anh google t√¨m hi·ªÉu th√¨ m√¨nh m·ªõi ng·ªô ra AFNetworking l√† m·ªôt tool wrap l·∫°i urlsession, h·ªó tr·ª£ developer thao t√°c nhanh g·ªçn, ƒë·ª° m·∫•t c√¥ng vi·∫øt ƒëi vi·∫øt l·∫°i nh·ªØng ƒëo·∫°n code th·ªß t·ª•c (lib ƒë√£ h·ªó tr·ª£ b·∫°n l√†m vi·ªác ƒë√≥). T·ª´ ƒë√≥ project n√†o m√¨nh c≈©ng g·∫Øn AFNetworking v√†o.</p>

<p>Tuy nhi√™n AFNetworking ƒë∆∞·ª£c vi·∫øt b·∫±ng obj-c v√† kh√¥ng c√≥ phi√™n b·∫£n swift. May m·∫Øn thay, ta c√≥ m·ªôt lib thay th·∫ø, ph·ªï bi·∫øn kh√¥ng k√©m tr√™n n·ªÅn swift.
Th·∫≠m ch√≠ ch√∫ng n√≥ c√≤n qu·∫£ng c√°o qua l·∫°i cho nhau üòÑ</p>

<blockquote>
<p>Programming in Swift? Try Alamofire for a more conventional set of APIs.</p>
</blockquote>

<p>T·∫≠n d·ª•ng s·ª©c tr·∫ª c·ªßa ng√¥n ng·ªØ m·ªõi n√™n Alamofire c√≥ c√°ch vi·∫øt b√≥ng b·∫©y, hi·ªán ƒë·∫°i h∆°n so v·ªõi ƒë√†n anh AFNetworking. V·∫≠y n√™n m√¨nh c≈©ng t·∫°o n√™n 1 l·ªõp wrap m·ªõi cho Alamofire ƒë·ªÉ s·ª≠ d·ª•ng chung gi·ªØa c√°c project c·ªßa m√¨nh.</p>

<h3 id="2-h∆∞·ªõng-ƒëi">2. H∆∞·ªõng ƒëi</h3>

<p>C√≥ l·∫Ω h·∫ßu h·∫øt ai c≈©ng wrap l·∫°i AFNetworking b·∫±ng c√°ch vi·∫øt 1 l·ªõp <em>APIClient</em> s·ª≠ d·ª•ng singleton v·ªõi h√†m init</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">-</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">instancetype</span><span style="color: #f8f8f2">)</span><span style="color: #a6e22e">initWithBaseURL:</span><span style="color: #f8f8f2">(NSURL</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">)url</span>
</pre></div>


<p>Ngay t·ª´ h√†m init ta c√≥ th·ªÉ t·∫°o baseURL cho to√†n b·ªô nh·ªØng API c·ªßa m√¨nh. C√°ch n√†y kh√° ti·ªán d·ª•ng khi project ch·ªâ s·ª≠ d·ª•ng duy nh·∫•t m·ªôt base url. Tuy nhi√™n project m·ªõi ƒë√¢y c·ªßa m√¨nh c√≥ t·∫≠n 3 base url. Th·∫ø n√™n vi·ªác s·ª≠ d·ª•ng singleton v·ªõi base url c√≥ v·∫ª kh√¥ng h·ª£p l√Ω l·∫Øm. C√≥ l·∫Ω ch√≠nh v√¨ th·∫ø ·ªü Alamofire ta kh√¥ng th·∫•y c√≥ h√†m t∆∞∆°ng t·ª± n·ªØa.</p>

<p>Tr√™n ƒë∆∞·ªùng t√¨m ki·∫øm h∆∞·ªõng ƒëi m·ªõi, m√¨nh th·∫•y m·ªôt c√°ch kh√° l√† hot trend: s·ª≠ d·ª•ng router. Alamofire cung c·∫•p cho ta protocol <em>URLRequestConvertible</em> ph·ª•c v·ª• m·ª•c ƒë√≠ch ƒë·∫•y</p>

<p>L·∫•y lu√¥n m·ªôt v√≠ d·ª• tri·ªÉn khai <em>URLRequestConvertible</em></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">Router:</span> <span style="color: #f8f8f2">URLRequestConvertible</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">search(query:</span> <span style="color: #f8f8f2">String,</span> <span style="color: #f8f8f2">page:</span> <span style="color: #f8f8f2">Int)</span>

    <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">baseURLString</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;https://example.com&quot;</span>
    <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">perPage</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">50</span>

    <span style="color: #75715e">// MARK: URLRequestConvertible</span>

    <span style="color: #f8f8f2">func</span> <span style="color: #f8f8f2">asURLRequest()</span> <span style="color: #f8f8f2">throws</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">URLRequest</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">result:</span> <span style="color: #f8f8f2">(path:</span> <span style="color: #f8f8f2">String,</span> <span style="color: #f8f8f2">parameters:</span> <span style="color: #f8f8f2">Parameters)</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
            <span style="color: #66d9ef">switch</span> <span style="color: #f8f8f2">self</span> <span style="color: #f8f8f2">{</span>
            <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">.search(query,</span> <span style="color: #f8f8f2">page)</span> <span style="color: #f8f8f2">where</span> <span style="color: #f8f8f2">page</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">:</span>
                <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;/search&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;q&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">query,</span> <span style="color: #e6db74">&quot;offset&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">Router.perPage</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">page])</span>
            <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">.search(query,</span> <span style="color: #f8f8f2">_)</span><span style="color: #f92672">:</span>
                <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;/search&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;q&quot;</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">query])</span>
            <span style="color: #f8f8f2">}</span>
        <span style="color: #f8f8f2">}()</span>

        <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">url</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">try</span> <span style="color: #f8f8f2">Router.baseURLString.asURL()</span>
        <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">urlRequest</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">URLRequest(url:</span> <span style="color: #f8f8f2">url.appendingPathComponent(result.path))</span>

        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">try</span> <span style="color: #f8f8f2">URLEncoding.</span><span style="color: #66d9ef">default</span><span style="color: #f8f8f2">.encode(urlRequest,</span> <span style="color: #f8f8f2">with:</span> <span style="color: #f8f8f2">result.parameters)</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>·ªû ƒë√¢y ta c·∫ßn ph·∫£i ƒë∆∞a ra c√°c th√¥ng tin ƒë·ªÉ t·∫°o ra request: base url, path, param. ƒê√¢y l√† c√°c tr∆∞·ªùng c∆° b·∫£n nh·∫•t, tuy nhi√™n ·ªü m·ªôt popular API ta c√≤n c·∫ßn bi·∫øt nh·ªØng th√¥ng tin kh√°c nh∆∞ method (get, set, put, delete), token,&hellip;N·∫øu ta tri·ªÉn khai h·∫øt trong 1 class implement <em>URLRequestConvertible</em> th√¨ vi·∫øt kh√° l√† d√†i d√≤ng so v·ªõi c√°ch t·∫°o m·ªôt BASE_URL duy nh·∫•t. ƒê√¢y l√† ƒëi·ªÅu m√† m√¨nh kh√¥ng mu·ªën üòÇ.</p>

<h3 id="3-tri·ªÉn-khai">3. Tri·ªÉn khai</h3>

<p>L·∫•y √Ω t∆∞·ªüng t·ª´ <a href="http://chris.eidhof.nl/post/typesafe-url-routes-in-swift/">chris.eidhof</a>, m√¨nh vi·∫øt theo h∆∞·ªõng t·∫°o ra 1 router bao g·ªìm c√°c th√¥ng tin thi·∫øt y·∫øu c·ªßa 1 API: url, method, token (kh√¥ng ƒë∆∞a th√¥ng tin params v√†o trong router)</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">public</span> <span style="color: #f8f8f2">protocol</span> <span style="color: #f8f8f2">ONPath</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">path</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">public</span> <span style="color: #f8f8f2">protocol</span> <span style="color: #f8f8f2">ONToken</span> <span style="color: #f8f8f2">{</span>
    
    <span style="color: #75715e">/// example: &quot;Bearer&quot;, &quot;Basic&quot;, etc</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">tokenKind</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">tokenStr</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">isAuthorization</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">Bool</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">public</span> <span style="color: #f8f8f2">protocol</span> <span style="color: #f8f8f2">ONMethod</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">method</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">Alamofire.HTTPMethod</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e">// protocol container</span>
<span style="color: #f8f8f2">public</span> <span style="color: #f8f8f2">protocol</span> <span style="color: #f8f8f2">ONUrl</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">ONPath,</span> <span style="color: #f8f8f2">ONToken,</span> <span style="color: #f8f8f2">ONMethod</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">baseURL</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">url</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">get</span> <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Kh√° l√† ƒë∆°n gi·∫£n. B√¢y gi·ªù ta s·∫Ω ƒë·ªãnh nghƒ©a 1 router d·ª±a tr√™n protocol tr√™n</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// MARK: - router for github</span>
<span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">ONGithubURL</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">ONUrl</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">baseURL:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">BASE_URL</span>
    <span style="color: #f8f8f2">}</span>

    <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">getGitHubUser(account</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String)</span>
    
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">path:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">switch</span> <span style="color: #f8f8f2">self</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">.getGitHubUser(let</span> <span style="color: #f8f8f2">acc)</span><span style="color: #f92672">:</span>
            <span style="color: #66d9ef">return</span> <span style="color: #e6db74">&quot;users/\(acc)&quot;</span>
        <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e">// MARK: - method for github urls</span>
<span style="color: #f8f8f2">extension</span> <span style="color: #f8f8f2">ONGithubURL</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">ONMethod</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">method:</span> <span style="color: #f8f8f2">HTTPMethod</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">switch</span> <span style="color: #f8f8f2">self</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">.getGitHubUser(_)</span><span style="color: #f92672">:</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">.get</span>
        <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e">// MARK: - generate token for github url</span>
<span style="color: #f8f8f2">extension</span> <span style="color: #f8f8f2">ONGithubURL</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">ONToken</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">isAuthorization:</span> <span style="color: #f8f8f2">Bool</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">switch</span> <span style="color: #f8f8f2">self</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">.getGitHubUser(_)</span><span style="color: #f92672">:</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">false</span>
        <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
    
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">tokenStr</span> <span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">switch</span> <span style="color: #f8f8f2">self</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">.getGitHubUser(_)</span><span style="color: #f92672">:</span>
            <span style="color: #66d9ef">return</span> <span style="color: #e6db74">&quot;&quot;</span>
        <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>T·ª´ enum ONGithubURL, ta c√≥ th·ªÉ t·∫°o ra router nh∆∞ sau</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">router</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ONGithubURL.getGitHubUser(account:</span> <span style="color: #e6db74">&quot;gg4acrossover&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">router.url</span> <span style="color: #75715e">// https://api.github.com/users/gg4acrossover</span>
<span style="color: #f8f8f2">router.method</span> <span style="color: #75715e">// GET</span>
</pre></div>
</p>

<p>V·ªõi c√°ch s·ª≠ d·ª•ng router nh∆∞ tr√™n ta c√≥ th·ªÉ t·∫°o ra url theo √Ω mu·ªën. T·ª´ ƒë√≥ ta c√≥ th·ªÉ t·∫°o h√†m call API s·ª≠ d·ª•ng Alamofire theo c√°ch sau</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">public</span> <span style="color: #f8f8f2">func</span> <span style="color: #a6e22e">call</span><span style="color: #f8f8f2">(router:</span> <span style="color: #f8f8f2">ONUrl,</span> <span style="color: #f8f8f2">params:</span> <span style="color: #f8f8f2">[String:</span> <span style="color: #f8f8f2">Any]</span><span style="color: #f92672">?</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nil,</span> <span style="color: #f8f8f2">success:</span> <span style="color: #f8f8f2">@escaping</span> <span style="color: #f8f8f2">responseJSON,</span> <span style="color: #f8f8f2">fail:</span> <span style="color: #f8f8f2">@escaping</span> <span style="color: #f8f8f2">responseError)</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">DataRequest</span> <span style="color: #f8f8f2">{</span>
    
    <span style="color: #75715e">// add accept header</span>
    <span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">headers</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;Accept&quot;</span> <span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;application/json,charset=utf-8,text/html&quot;</span><span style="color: #f8f8f2">]</span>
    
    <span style="color: #75715e">// add authorization if need</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">router.isAuthorization</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">headers[</span><span style="color: #e6db74">&quot;Authorization&quot;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">router.tokenKind</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">router.tokenStr</span>
    <span style="color: #f8f8f2">}</span>
    
    <span style="color: #f8f8f2">debugPrint(router.method.rawValue</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">router.url)</span>
    <span style="color: #f8f8f2">debugPrint(</span><span style="color: #e6db74">&quot;Headers: \(headers)&quot;</span><span style="color: #f8f8f2">)</span>
    
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">sessionMng.request(router.url,</span> <span style="color: #f8f8f2">method:</span> <span style="color: #f8f8f2">router.method,</span> <span style="color: #f8f8f2">parameters:</span> <span style="color: #f8f8f2">params,</span> <span style="color: #f8f8f2">headers:</span> <span style="color: #f8f8f2">headers)</span>
                     <span style="color: #f8f8f2">.validate()</span>
                     <span style="color: #f8f8f2">.responseJSON</span> <span style="color: #f8f8f2">{</span> <span style="color: #f8f8f2">response</span> <span style="color: #66d9ef">in</span>
            <span style="color: #66d9ef">switch</span> <span style="color: #f8f8f2">response.result</span> <span style="color: #f8f8f2">{</span>
            <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">.success(let</span> <span style="color: #f8f8f2">value)</span><span style="color: #f92672">:</span>
                <span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">json</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">JSON(value)</span>
                <span style="color: #f8f8f2">success(json)</span>
            <span style="color: #66d9ef">case</span> <span style="color: #f8f8f2">.failure(let</span> <span style="color: #f8f8f2">error)</span><span style="color: #f92672">:</span>
                <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">error._code</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">NSURLErrorTimedOut</span> <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">debugPrint(</span><span style="color: #e6db74">&quot;Request Timeout...&quot;</span><span style="color: #f8f8f2">)</span>
                <span style="color: #f8f8f2">}</span>
                <span style="color: #f8f8f2">fail(error)</span>
        <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>V√≠ d·ª• s·ª≠ d·ª•ng ONGithubURL enum</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">let</span> <span style="color: #f8f8f2">router</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ONGithubURL.getGitHubUser(account:</span> <span style="color: #e6db74">&quot;gg4acrossover&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">ONAPIClient.</span><span style="color: #66d9ef">default</span><span style="color: #f8f8f2">.call(router:</span> <span style="color: #f8f8f2">router,</span> <span style="color: #f8f8f2">success:</span> <span style="color: #f8f8f2">success,</span> <span style="color: #f8f8f2">fail:</span> <span style="color: #f8f8f2">fail)</span>
</pre></div>
</p>

<p>Code tham kh·∫£o: <a href="https://github.com/gg4acrossover/swiftForFun/tree/master/Project%2003%20-OnAPIClient">source</a></p>

<p>C√°c b√†i vi·∫øt c√≥ th·ªÉ tham kh·∫£o th√™m:</p>

<ul>
<li><p><a href="http://chris.eidhof.nl/post/typesafe-url-routes-in-swift/">typesafe url routes in swift</a></p></li>

<li><p><a href="https://chaione.com/blog/rethinking-routers-swift-protocol-oriented-programming-part-1/">rethinking routers</a></p></li>

<li><p><a href="https://github.com/Moya/Moya">Moya</a></p></li>
</ul>

    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="https://gg4acrossover.github.io/hugosite/">GG4aCrossover</a></h4>
  
  <p>Coder nh√¢n d√¢n</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">HaNoi, VietNam</span>
    <span class="author-link icon-link"><a href="http://gg4acrossover.github.io/">http://gg4acrossover.github.io/</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=T%e1%ba%a1o%20APIClient%20v%e1%bb%9bi%20swift%203&nbsp;-&nbsp;GG4aCrossover&amp;url=https%3a%2f%2fgg4acrossover.github.io%2fhugosite%2ftao-progress-hud-don-gian%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fgg4acrossover.github.io%2fhugosite%2ftao-progress-hud-don-gian%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fgg4acrossover.github.io%2fhugosite%2ftao-progress-hud-don-gian%2f&amp;description=T%e1%ba%a1o%20APIClient%20v%e1%bb%9bi%20swift%203"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fgg4acrossover.github.io%2fhugosite%2ftao-progress-hud-don-gian%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'gg4acrossover';
  var disqus_url = 'https:\/\/gg4acrossover.github.io\/hugosite\/tao-progress-hud-don-gian\/';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




  </footer>
</article>

</main>


  <aside class="read-next">
  
  
      <a class="read-next-story prev" style="no-cover" href="/hugosite/progress-hud-don-gian/">
          <section class="post">
              <h2>T·∫°o progressHUD ƒë∆°n gi·∫£n</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">GG4aCrossover</a> All rights reserved - 2016</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/hugosite/js/jquery.js"></script>
    <script type="text/javascript" src="/hugosite/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/hugosite/js/index.js"></script>
    
</body>
</html>

